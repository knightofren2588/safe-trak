<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SafeTrack - Safety Project Management</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <!-- Custom CSS -->
    <link href="assets/css/style.css" rel="stylesheet">
    
    <!-- Export Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'safety-blue': '#1e40af',
                        'safety-green': '#059669',
                        'safety-orange': '#ea580c',
                        'safety-red': '#dc2626',
                        'safety-gray': '#6b7280',
                        'safety-yellow': '#f59e0b',
                        'safety-emergency': '#ef4444',
                        'safety-caution': '#f97316',
                        'safety-safe': '#10b981',
                        'safety-info': '#3b82f6'
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-slate-50 min-h-screen">
    <!-- Simple Login Modal -->
    <div class="modal fade" id="loginModal" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header text-center border-0 pb-0">
                    <div class="w-100">
                        <div class="mb-3">
                            <div class="d-inline-flex p-3 rounded-circle" style="background: linear-gradient(135deg, var(--safety-red) 0%, #b91c1c 100%);">
                                <i class="fas fa-shield-alt text-white" style="font-size: 2rem;"></i>
                            </div>
                        </div>
                        <h4 class="modal-title" style="color: var(--safety-red);">SafeTrack Access</h4>
                        <p class="text-muted mb-0">Enter credentials to access the safety management system</p>
                    </div>
                </div>
                <div class="modal-body px-4 pb-4">
                    <form id="loginForm">
                        <div class="mb-3">
                            <label for="loginUsername" class="form-label">Username</label>
                            <input type="text" class="form-control form-control-enhanced" id="loginUsername" required 
                                   placeholder="Enter username" autocomplete="username">
                        </div>
                        <div class="mb-4">
                            <label for="loginPassword" class="form-label">Password</label>
                            <input type="password" class="form-control form-control-enhanced" id="loginPassword" required 
                                   placeholder="Enter password" autocomplete="current-password">
                        </div>
                        <button type="submit" class="btn btn-safety w-100 btn-enhanced" id="loginSubmitBtn">
                            <i class="fas fa-sign-in-alt me-2"></i>Access SafeTrack
                        </button>
                    </form>
                    <div id="loginError" class="alert alert-danger mt-3 d-none">
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        Invalid credentials. Please try again.
                    </div>
                </div>
                <div class="modal-footer border-0 pt-0">
                    <div class="w-100 text-center">
                        <small class="text-muted">
                            <i class="fas fa-lock me-1"></i>
                            Secure access for safety team
                        </small>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- User Selection Modal -->
    <div class="modal fade" id="userSelectionModal" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header text-center border-0 pb-0">
                    <div class="w-100">
                        <div class="mb-3">
                            <div class="d-inline-flex p-3 rounded-circle" style="background: linear-gradient(135deg, var(--safety-blue) 0%, #0a58ca 100%);">
                                <i class="fas fa-users text-white" style="font-size: 2rem;"></i>
                            </div>
                        </div>
                        <h4 class="modal-title" style="color: var(--safety-blue);">Select Your Profile</h4>
                        <p class="text-muted mb-0">Choose which team member profile you'll be working as</p>
                    </div>
                </div>
                <div class="modal-body px-4 pb-4">
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle me-2"></i>
                        <strong>Important:</strong> This determines which projects and certifications you can see and manage.
                    </div>
                    
                    <div class="row g-3" id="userSelectionGrid">
                        <!-- User cards will be populated here -->
                    </div>
                </div>
                <div class="modal-footer border-0 pt-0">
                    <div class="w-100 text-center">
                        <small class="text-muted">
                            <i class="fas fa-shield-alt me-1"></i>
                            SafeTrack - Safety Management
                        </small>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="bg-white shadow-lg" style="border-bottom: 4px solid var(--safety-red);">
        <div class="pl-4 pr-6 py-6">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <!-- Larger Shield Icon -->
                    <div class="flex-shrink-0">
                        <div class="p-4 rounded-xl shadow-lg hover-scale" style="background: linear-gradient(135deg, var(--safety-red) 0%, #b91c1c 100%); color: white;">
                            <i class="fas fa-shield-alt" style="font-size: 2.5rem;"></i>
                        </div>
                    </div>
                    
                    <!-- Title and Info -->
                    <div class="flex-1">
                        <div class="flex items-center space-x-3 mb-2">
                            <h1 class="text-3xl font-bold" style="color: var(--safety-red);">SafeTrack</h1>
                            <div class="px-3 py-1 rounded-full text-xs font-semibold" style="background: var(--safety-yellow); color: #000;">
                                SAFETY FIRST
                            </div>
                        </div>
                        <p class="text-sm text-gray-600 mb-3">Advanced Safety Project Management System</p>
                        
                        <!-- Daily Safety Quote -->
                        <div class="safety-quote">
                            <div class="d-flex justify-content-between align-items-start">
                                <div class="flex-grow-1">
                                    <div class="safety-quote-text" id="dailySafetyQuote">
                                        "Safety is not a gadget but a state of mind."
                                    </div>
                                    <div class="safety-quote-author" id="dailySafetyAuthor">
                                        â€” Eleanor Everet
                                    </div>
                                </div>
                                <div class="quote-controls">
                                    <button class="btn btn-sm btn-outline-light" onclick="getNewQuote()" title="Get new random quote" aria-label="Get new quote">
                                        <i class="fas fa-refresh"></i>
                                    </button>
                                    <button class="btn btn-sm btn-outline-light" onclick="openQuoteModal()" title="Manage quotes" aria-label="Manage quotes">
                                        <i class="fas fa-cog"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="flex flex-col items-end space-y-3">
                    <!-- Welcome Banner -->
                    <div id="welcomeBanner" class="welcome-banner text-right">
                        <div class="welcome-message">Welcome,</div>
                        <div class="welcome-username" id="welcomeUsername">Admin User</div>
                        <div class="welcome-role" id="welcomeUserRole">Administrator</div>
                    </div>
                    
                    <!-- Controls Row -->
                    <div class="flex items-center space-x-4">
                        <!-- Archive -->
                        <div class="me-3">
                            <!-- Archive feature removed -->
                        </div>

                        <!-- Notifications disabled -->

                        <!-- Connection Status Indicator -->
                    <div id="connectionStatus" class="d-flex align-items-center me-3">
                        <div id="connectionIndicator" class="badge bg-warning me-2">
                            <i class="fas fa-cloud-upload-alt me-1"></i>Connecting...
                        </div>
                        <button id="syncButton" class="btn btn-sm btn-outline-safety" onclick="syncData()" title="Sync with cloud">
                            <i class="fas fa-sync-alt"></i>
                        </button>
                    </div>
                    
                    <!-- User switching removed for security - users locked to selected profile -->
                    
                    <!-- Project View Toggle -->
                    <div class="dropdown">
                        <button class="btn btn-outline-secondary dropdown-toggle" type="button" id="viewToggle" data-bs-toggle="dropdown" aria-expanded="false">
                            <i class="fas fa-eye me-2"></i>
                            <span id="currentViewMode">My Projects</span>
                        </button>
                        <ul class="dropdown-menu" aria-labelledby="viewToggle">
                            <li><h6 class="dropdown-header">Project View</h6></li>
                            <li><a class="dropdown-item" href="#" onclick="toggleProjectView('personal')">
                                <i class="fas fa-user me-2"></i>My Projects Only
                            </a></li>
                            <li><a class="dropdown-item" href="#" onclick="toggleProjectView('all')">
                                <i class="fas fa-users me-2"></i>All Team Projects
                            </a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><h6 class="dropdown-header">Individual Views</h6></li>
                            <div id="individualUserViews">
                                <!-- Dynamic individual user views will be populated here -->
                            </div>
                            <!-- Admin-only options -->
                            <div id="adminOnlyOptions" style="display: none;">
                                <li><hr class="dropdown-divider"></li>
                                <li><a class="dropdown-item" href="#" onclick="openUserManagement()">
                                    <i class="fas fa-users-cog me-2"></i>Manage Team Members
                                </a></li>
                                <li><hr class="dropdown-divider"></li>
                                <li><a class="dropdown-item text-danger" href="#" onclick="resetAllData()">
                                    <i class="fas fa-trash me-2"></i>Reset All Data
                                </a></li>
                            </div>
                        </ul>
                    </div>
                    <button class="btn btn-safety btn-enhanced btn-press hover-lift" onclick="openProjectModal()" 
                            aria-label="Create a new safety project">
                        <i class="fas fa-plus me-2" aria-hidden="true"></i>New Safety Project
                    </button>
                    <button class="btn btn-outline-danger btn-sm ms-2" onclick="logout()" title="Logout" aria-label="Logout">
                        <i class="fas fa-sign-out-alt"></i>
                    </button>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Navigation -->
    <nav class="bg-white shadow-sm border-b">
        <div class="pl-4 pr-6">
            <div class="flex space-x-8">
                <button class="tab-btn active py-4 px-2 border-b-2 font-medium" style="border-color: var(--safety-red); color: var(--safety-red);" data-tab="projects">
                    <i class="fas fa-project-diagram mr-2"></i>Safety Projects
                </button>
                <button class="tab-btn py-4 px-2 border-b-2 border-transparent text-gray-600" data-tab="dashboard">
                    <i class="fas fa-shield-alt mr-2"></i>Safety Dashboard
                </button>
                <!-- TEMPORARILY HIDDEN: Compliance and Certifications tabs -->
                <!-- 
                <button class="tab-btn py-4 px-2 border-b-2 border-transparent text-gray-600" data-tab="compliance">
                    <i class="fas fa-clipboard-check mr-2"></i>Safety Compliance
                </button>
                <button class="tab-btn py-4 px-2 border-b-2 border-transparent text-gray-600" data-tab="certifications">
                    <i class="fas fa-certificate mr-2"></i>Certifications
                </button>
                -->
                <button class="tab-btn py-4 px-2 border-b-2 border-transparent text-gray-600" data-tab="reports">
                    <i class="fas fa-chart-line mr-2"></i>Safety Reports
                </button>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="main-container animate-fade-in">
        <!-- Dashboard Tab -->
        <div id="dashboard" class="tab-content d-none">
            <!-- Stats Cards -->
            <div class="row g-3 mb-4">
                <div class="col-lg-6 col-md-6">
                    <div class="stats-card card-interactive hover-lift fade-in" role="region" aria-labelledby="active-projects-label">
                        <div class="icon-circle success">
                            <i class="fas fa-check-circle" aria-hidden="true"></i>
                                </div>
                        <div class="stats-content">
                            <div class="stats-info">
                                <div class="stats-number" id="activeProjects" aria-live="polite">12</div>
                                <div class="stats-label" id="active-projects-label">Active Safety Projects</div>
                                </div>
                            <div class="stats-trend">
                                <i class="fas fa-arrow-up trend-up" aria-hidden="true"></i> 
                                <span class="sr-only">Increased by </span>+2 this week
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-6 col-md-6">
                    <div class="stats-card card-interactive hover-lift fade-in" role="region" aria-labelledby="at-risk-projects-label" style="animation-delay: 0.1s;">
                        <div class="icon-circle warning">
                            <i class="fas fa-exclamation-triangle" aria-hidden="true"></i>
                                </div>
                        <div class="stats-content">
                            <div class="stats-info">
                                <div class="stats-number" id="atRiskProjects" aria-live="polite">3</div>
                                <div class="stats-label" id="at-risk-projects-label">Safety Risk Projects</div>
                                </div>
                            <div class="stats-trend">
                                <i class="fas fa-arrow-down trend-down" aria-hidden="true"></i> 
                                <span class="sr-only">Decreased by </span>-1 this week
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-6 col-md-6">
                    <div class="stats-card card-interactive hover-lift fade-in" role="region" aria-labelledby="team-members-label" style="animation-delay: 0.2s;">
                        <div class="icon-circle primary">
                            <i class="fas fa-users" aria-hidden="true"></i>
                                </div>
                        <div class="stats-content">
                            <div class="stats-info">
                                <div class="stats-number" id="teamMembers" aria-live="polite">24</div>
                                <div class="stats-label" id="team-members-label">Safety Team Members</div>
                                </div>
                            <div class="stats-trend">
                                <i class="fas fa-minus trend-neutral" aria-hidden="true"></i> 
                                <span class="sr-only">No change in </span>No change
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-6 col-md-6">
                    <div class="stats-card card-interactive hover-lift fade-in" role="region" aria-labelledby="overdue-projects-label" style="animation-delay: 0.3s;">
                        <div class="icon-circle danger">
                            <i class="fas fa-calendar-times" aria-hidden="true"></i>
                                </div>
                        <div class="stats-content">
                            <div class="stats-info">
                                <div class="stats-number" id="overdueProjects" aria-live="polite">1</div>
                                <div class="stats-label" id="overdue-projects-label">Overdue Safety Items</div>
                                </div>
                            <div class="stats-trend">
                                <i class="fas fa-arrow-up trend-down" aria-hidden="true"></i> 
                                <span class="sr-only">Increased by </span>+1 this week
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Recent Projects -->
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-white border-bottom">
                    <h5 class="card-title mb-0 d-flex align-items-center">
                        <i class="fas fa-shield-alt me-2 text-safety-blue"></i>
                        Recent Safety Projects
                    </h5>
                </div>
                <div class="card-body">
                    <div id="recentProjectsList">
                        <!-- Projects will be loaded here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Projects Tab -->
        <div id="projects" class="tab-content">
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-white border-bottom">
                    <div class="d-flex justify-content-between align-items-center">
                        <h5 class="card-title mb-0" id="projectTableTitle">All Safety Projects</h5>
                        <div class="d-flex gap-2 flex-wrap">
                            <!-- Search Input -->
                            <input type="text" id="searchInput" placeholder="Search projects..." class="form-control" style="width: 180px;">
                            
                            <!-- Status Filter -->
                            <select id="statusFilter" class="form-select" style="width: 130px;">
                                <option value="">All Status</option>
                                <option value="active">Active</option>
                                <option value="on-going">Ongoing</option>
                                <option value="completed">Completed</option>
                                <option value="on-hold">On Hold</option>
                                <option value="cancelled">Cancelled</option>
                                <option value="overdue">Overdue</option>
                            </select>
                            
                            <!-- User Filter -->
                            <select id="userFilter" class="form-select" style="width: 140px;">
                                <option value="">All Users</option>
                                <!-- Will be populated dynamically -->
                            </select>
                            
                            <!-- Date Range Filter -->
                            <select id="dateFilter" class="form-select" style="width: 140px;">
                                <option value="">All Dates</option>
                                <option value="this-week">This Week</option>
                                <option value="this-month">This Month</option>
                                <option value="last-30-days">Last 30 Days</option>
                                <option value="overdue-items">Overdue Items</option>
                                <option value="due-soon">Due Soon (7 days)</option>
                                <option value="no-deadline">No Deadline</option>
                            </select>
                            
                            <!-- Sort By -->
                            <select id="sortBy" class="form-select" style="width: 140px;">
                                <option value="">Sort By</option>
                                <option value="name-asc">Name (A-Z)</option>
                                <option value="name-desc">Name (Z-A)</option>
                                <option value="start-date-asc">Start Date (Oldest)</option>
                                <option value="start-date-desc">Start Date (Newest)</option>
                                <option value="due-date-asc">Due Date (Soonest)</option>
                                <option value="due-date-desc">Due Date (Latest)</option>
                                <option value="completion-date-asc">Completed (Oldest)</option>
                                <option value="completion-date-desc">Completed (Newest)</option>
                                <option value="created-date-asc">Created (Oldest)</option>
                                <option value="created-date-desc">Created (Newest)</option>
                                <option value="priority-high">Priority (High First)</option>
                                <option value="priority-low">Priority (Low First)</option>
                                <option value="progress-asc">Progress (Low First)</option>
                                <option value="progress-desc">Progress (High First)</option>
                            </select>
                            
                            <!-- Advanced Filters Button -->
                            <button class="btn btn-outline-secondary" type="button" id="moreFiltersBtn" onclick="toggleAdvancedFilters()">
                                <i class="fas fa-filter me-1"></i>More Filters
                            </button>
                            
                            <!-- Clear Filters Button -->
                            <button class="btn btn-outline-warning" onclick="clearAllFilters()" title="Clear All Filters">
                                <i class="fas fa-times me-1"></i>Clear
                            </button>
                            
                            <!-- Import Dropdown -->
                            <div class="dropdown me-2">
                                <button class="btn btn-outline-primary dropdown-toggle" type="button" id="importDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                                    <i class="fas fa-upload me-2"></i>Import
                                </button>
                                <ul class="dropdown-menu" aria-labelledby="importDropdown">
                                    <li><a class="dropdown-item" href="#" onclick="projectManager.openImportModal('excel')">
                                        <i class="fas fa-file-excel me-2 text-success"></i>Import from Excel
                                    </a></li>
                                    <li><a class="dropdown-item" href="#" onclick="projectManager.openImportModal('csv')">
                                        <i class="fas fa-file-csv me-2 text-info"></i>Import from CSV
                                    </a></li>
                                    <li><a class="dropdown-item" href="#" onclick="projectManager.openImportModal('notion')">
                                        <i class="fab fa-notion me-2 text-dark"></i>Import from Notion
                                    </a></li>
                                    <li><hr class="dropdown-divider"></li>
                                    <li><a class="dropdown-item" href="#" onclick="projectManager.downloadImportTemplate()">
                                        <i class="fas fa-download me-2 text-secondary"></i>Download Template
                                    </a></li>
                                </ul>
                            </div>

                            <!-- Export Dropdown -->
                            <div class="dropdown">
                                <button class="btn btn-outline-success dropdown-toggle" type="button" id="exportDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                                    <i class="fas fa-download me-2"></i>Export
                                </button>
                                <ul class="dropdown-menu" aria-labelledby="exportDropdown">
                                    <li><a class="dropdown-item" href="#" onclick="exportToExcel()">
                                        <i class="fas fa-file-excel me-2 text-success"></i>Export to Excel
                                    </a></li>
                                    <li><a class="dropdown-item" href="#" onclick="exportToPDF()">
                                        <i class="fas fa-file-pdf me-2 text-danger"></i>Export to PDF
                                    </a></li>
                                    <li><a class="dropdown-item" href="#" onclick="exportToCSV()">
                                        <i class="fas fa-file-csv me-2 text-info"></i>Export to CSV
                                    </a></li>
                                    <li><hr class="dropdown-divider"></li>
                                    <li><a class="dropdown-item" href="#" onclick="printReport()">
                                        <i class="fas fa-print me-2 text-secondary"></i>Print Report
                                    </a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Advanced Filters (Collapsible) -->
                <div id="advancedFilters" style="display: none;">
                    <div class="px-4 py-3 bg-light border-bottom">
                        <div class="row g-3">
                            <div class="col-md-3">
                                <label for="priorityFilter" class="form-label small">Priority</label>
                                <select id="priorityFilter" class="form-select form-select-sm">
                                    <option value="">All Priorities</option>
                                    <option value="high">High Priority</option>
                                    <option value="medium">Medium Priority</option>
                                    <option value="low">Low Priority</option>
                                </select>
                            </div>
                            <div class="col-md-3">
                                <label for="categoryFilter" class="form-label small">Category</label>
                                <select id="categoryFilter" class="form-select form-select-sm">
                                    <option value="">All Categories</option>
                                    <!-- Will be populated dynamically -->
                                </select>
                            </div>
                            <div class="col-md-3">
                                <label for="progressFilter" class="form-label small">Progress Range</label>
                                <select id="progressFilter" class="form-select form-select-sm">
                                    <option value="">All Progress</option>
                                    <option value="not-started">Not Started (0%)</option>
                                    <option value="in-progress">In Progress (1-99%)</option>
                                    <option value="completed">Completed (100%)</option>
                                    <option value="low-progress">Low Progress (0-25%)</option>
                                    <option value="high-progress">High Progress (75-99%)</option>
                                </select>
                            </div>
                            <div class="col-md-3">
                                <label for="customDateRange" class="form-label small">Custom Date Range</label>
                                <div class="d-flex gap-1">
                                    <input type="date" id="startDateFilter" class="form-control form-control-sm" title="Start Date From">
                                    <input type="date" id="endDateFilter" class="form-control form-control-sm" title="Start Date To">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- User Color Legend -->
                <div class="px-4 py-3 bg-light border-bottom">
                    <div id="userColorLegend">
                        <!-- Color legend will be populated here -->
                    </div>
                </div>
                
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-hover mb-0">
                            <thead class="table-light">
                                <tr>
                                    <th class="border-0">Project</th>
                                    <th class="border-0">Status</th>
                                    <th class="border-0">Progress</th>
                                    <th class="border-0">Start Date</th>
                                    <th class="border-0">Due Date</th>
                                    <th class="border-0">Completed</th>
                                    <th class="border-0">Assigned To</th>
                                    <th class="border-0">Screenshots</th>
                                    <th class="border-0">Quick Actions</th>
                                    <th class="border-0">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="projectTableBody">
                                <!-- Projects will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Compliance Tab - TEMPORARILY HIDDEN -->
        <div id="compliance" class="tab-content d-none" style="display: none !important;">
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-white border-bottom">
                    <h5 class="card-title mb-0 d-flex align-items-center">
                        <i class="fas fa-shield-alt me-2 text-safety-blue"></i>
                        Safety Compliance Dashboard
                    </h5>
                </div>
                <div class="card-body">
                    <!-- Compliance Overview Cards -->
                    <div class="row g-4 mb-4">
                        <div class="col-md-3">
                            <div class="card bg-gradient text-white" style="background: linear-gradient(135deg, #059669, #10b981);">
                                <div class="card-body text-center">
                                    <i class="fas fa-check-circle fs-1 mb-2"></i>
                                    <h6>Completed Projects</h6>
                                    <h3 id="completedProjectsCount">0</h3>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card bg-gradient text-white" style="background: linear-gradient(135deg, #f59e0b, #fbbf24);">
                                <div class="card-body text-center">
                                    <i class="fas fa-exclamation-triangle fs-1 mb-2"></i>
                                    <h6>Overdue Projects</h6>
                                    <h3 id="overdueProjectsCount">0</h3>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card bg-gradient text-white" style="background: linear-gradient(135deg, #3b82f6, #60a5fa);">
                                <div class="card-body text-center">
                                    <i class="fas fa-clock fs-1 mb-2"></i>
                                    <h6>In Progress</h6>
                                    <h3 id="activeProjectsCount">0</h3>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card bg-gradient text-white" style="background: linear-gradient(135deg, #8b5cf6, #a78bfa);">
                                <div class="card-body text-center">
                                    <i class="fas fa-percentage fs-1 mb-2"></i>
                                    <h6>Compliance Rate</h6>
                                    <h3 id="complianceRate">0%</h3>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Compliance Checklist -->
                    <div class="row g-4">
                        <div class="col-md-8">
                            <div class="card">
                                <div class="card-header d-flex justify-content-between align-items-center">
                                    <h6 class="mb-0">
                                        <i class="fas fa-list-check me-2"></i>Safety Compliance Checklist
                                    </h6>
                                    <button class="btn btn-sm btn-primary" onclick="addComplianceItem()">
                                        <i class="fas fa-plus me-1"></i>Add Item
                                    </button>
                                </div>
                                <div class="card-body p-0">
                                    <div class="table-responsive">
                                        <table class="table table-hover mb-0">
                                            <thead class="table-light">
                                                <tr>
                                                    <th width="40">Status</th>
                                                    <th>Compliance Item</th>
                                                    <th width="140">Date of Training</th>
                                                    <th width="100">Assigned To</th>
                                                    <th width="100">Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody id="complianceTableBody">
                                                <!-- Will be populated by JavaScript -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card">
                                <div class="card-header">
                                    <h6 class="mb-0">
                                        <i class="fas fa-bell me-2"></i>Compliance Alerts
                                    </h6>
                                </div>
                                <div class="card-body">
                                    <div id="complianceAlerts">
                                        <!-- Will be populated by JavaScript -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Certifications Tab - TEMPORARILY HIDDEN -->
        <div id="certifications" class="tab-content d-none" style="display: none !important;">
            <!-- Certification Overview Cards -->
            <div class="row g-3 mb-4">
                <div class="col-lg-3 col-md-6">
                    <div class="stats-card card-interactive hover-lift fade-in" role="region" aria-labelledby="total-certs-label">
                        <div class="icon-circle" style="background: linear-gradient(135deg, var(--safety-green) 0%, #146c43 100%);">
                            <i class="fas fa-certificate" aria-hidden="true"></i>
                        </div>
                        <div class="stats-content">
                            <div class="stats-info">
                                <div class="stats-number" id="totalCertifications" aria-live="polite">0</div>
                                <div class="stats-label" id="total-certs-label">Total Certifications</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-3 col-md-6">
                    <div class="stats-card card-interactive hover-lift fade-in" role="region" aria-labelledby="active-certs-label" style="animation-delay: 0.1s;">
                        <div class="icon-circle" style="background: linear-gradient(135deg, var(--safety-blue) 0%, #0a58ca 100%);">
                            <i class="fas fa-check-circle" aria-hidden="true"></i>
                        </div>
                        <div class="stats-content">
                            <div class="stats-info">
                                <div class="stats-number" id="activeCertifications" aria-live="polite">0</div>
                                <div class="stats-label" id="active-certs-label">Active Certifications</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-3 col-md-6">
                    <div class="stats-card card-interactive hover-lift fade-in" role="region" aria-labelledby="expiring-certs-label" style="animation-delay: 0.2s;">
                        <div class="icon-circle" style="background: linear-gradient(135deg, var(--safety-orange) 0%, #e8590c 100%);">
                            <i class="fas fa-clock" aria-hidden="true"></i>
                        </div>
                        <div class="stats-content">
                            <div class="stats-info">
                                <div class="stats-number" id="expiringCertifications" aria-live="polite">0</div>
                                <div class="stats-label" id="expiring-certs-label">Expiring Soon</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-3 col-md-6">
                    <div class="stats-card card-interactive hover-lift fade-in" role="region" aria-labelledby="expired-certs-label" style="animation-delay: 0.3s;">
                        <div class="icon-circle" style="background: linear-gradient(135deg, var(--safety-red) 0%, #b02a37 100%);">
                            <i class="fas fa-exclamation-triangle" aria-hidden="true"></i>
                        </div>
                        <div class="stats-content">
                            <div class="stats-info">
                                <div class="stats-number" id="expiredCertifications" aria-live="polite">0</div>
                                <div class="stats-label" id="expired-certs-label">Expired</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Certifications Management -->
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-white border-bottom">
                    <div class="d-flex justify-content-between align-items-center">
                        <h5 class="card-title mb-0 d-flex align-items-center">
                            <i class="fas fa-certificate me-2 text-safety-blue"></i>
                            <span id="certificationTableTitle">My Certifications</span>
                        </h5>
                        <div class="d-flex gap-2">
                            <div class="dropdown">
                                <button class="btn btn-outline-secondary dropdown-toggle btn-enhanced" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                                    <i class="fas fa-download me-2"></i>Export
                                </button>
                                <ul class="dropdown-menu">
                                    <li><h6 class="dropdown-header">Export Certifications</h6></li>
                                    <li><a class="dropdown-item" href="#" onclick="exportCertificationsToExcel()">
                                        <i class="fas fa-file-excel text-success me-2"></i>Excel (.xlsx)
                                    </a></li>
                                    <li><a class="dropdown-item" href="#" onclick="exportCertificationsToPDF()">
                                        <i class="fas fa-file-pdf text-danger me-2"></i>PDF Document
                                    </a></li>
                                    <li><a class="dropdown-item" href="#" onclick="exportCertificationsToCSV()">
                                        <i class="fas fa-file-csv text-info me-2"></i>CSV (.csv)
                                    </a></li>
                                    <li><hr class="dropdown-divider"></li>
                                    <li><a class="dropdown-item" href="#" onclick="printCertifications()">
                                        <i class="fas fa-print text-secondary me-2"></i>Print Report
                                    </a></li>
                                </ul>
                            </div>
                            <button class="btn btn-safety btn-enhanced btn-press hover-lift" onclick="openCertificationModal()" 
                                    aria-label="Add new certification">
                                <i class="fas fa-plus me-2" aria-hidden="true"></i>Add Certification
                            </button>
                        </div>
                    </div>
                </div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-hover mb-0">
                            <thead class="table-light">
                                <tr>
                                    <th scope="col">Certification</th>
                                    <th scope="col">Provider</th>
                                    <th scope="col">Status</th>
                                    <th scope="col">Issue Date</th>
                                    <th scope="col">Expiry Date</th>
                                    <th scope="col">Certificate</th>
                                    <th scope="col">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="certificationTableBody">
                                <tr>
                                    <td colspan="7" class="text-center text-muted py-4">
                                        <i class="fas fa-certificate fa-2x mb-2 d-block"></i>
                                        No certifications found. Add your first certification to get started.
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Reports Tab -->
        <div id="reports" class="tab-content d-none">
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-white border-bottom">
                    <h5 class="card-title mb-0 d-flex align-items-center">
                        <i class="fas fa-chart-line me-2 text-safety-blue"></i>
                        Safety Reports & Analytics
                    </h5>
                </div>
                <div class="card-body">
                    <!-- Export Options -->
                    <div class="row g-4 mb-4">
                        <div class="col-md-4">
                            <button class="btn btn-outline-primary w-100 h-100 p-4 text-start border-2 hover-shadow" onclick="exportToPDF()">
                                <i class="fas fa-file-pdf text-danger mb-2 fs-4"></i>
                                <h6 class="fw-bold">PDF Report</h6>
                                <p class="text-muted small mb-0">Generate comprehensive safety project report</p>
                            </button>
                        </div>
                        <div class="col-md-4">
                            <button class="btn btn-outline-success w-100 h-100 p-4 text-start border-2 hover-shadow" onclick="exportToExcel()">
                                <i class="fas fa-file-excel text-success mb-2 fs-4"></i>
                                <h6 class="fw-bold">Excel Export</h6>
                                <p class="text-muted small mb-0">Export data for analysis and reporting</p>
                            </button>
                        </div>
                        <div class="col-md-4">
                            <button class="btn btn-outline-info w-100 h-100 p-4 text-start border-2 hover-shadow" onclick="exportToCSV()">
                                <i class="fas fa-table text-info mb-2 fs-4"></i>
                                <h6 class="fw-bold">CSV Export</h6>
                                <p class="text-muted small mb-0">Raw data for external systems</p>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Analytics Overview -->
                    <div class="row g-4">
                        <div class="col-md-6">
                            <div class="card border-0 bg-light">
                                <div class="card-body">
                                    <h6 class="card-title">
                                        <i class="fas fa-chart-pie me-2 text-primary"></i>Project Status Breakdown
                                    </h6>
                                    <div id="statusBreakdown" class="mt-3">
                                        <!-- Will be populated by JavaScript -->
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card border-0 bg-light">
                                <div class="card-body">
                                    <h6 class="card-title">
                                        <i class="fas fa-users me-2 text-success"></i>Team Performance
                                    </h6>
                                    <div id="teamPerformance" class="mt-3">
                                        <!-- Will be populated by JavaScript -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Project Modal -->
    <div class="modal fade" id="projectModal" tabindex="-1" aria-labelledby="projectModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="modalTitle">New Safety Project</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <form id="projectForm">
                    <div class="modal-body">
                        <div class="row g-3">
                            <div class="col-md-12">
                                <label for="projectName" class="form-label">Safety Project Name *</label>
                                <input type="text" class="form-control" id="projectName" name="name" required>
                            </div>
                            <div class="col-md-12">
                                <label for="projectDescription" class="form-label">Safety Description</label>
                                <textarea class="form-control" id="projectDescription" name="description" rows="3"></textarea>
                            </div>
                            <div class="col-md-6">
                                <label for="projectPriority" class="form-label">Safety Priority *</label>
                                <select class="form-select" id="projectPriority" name="priority" required>
                                    <option value="">Select Safety Priority</option>
                                    <option value="critical">Critical Safety Risk</option>
                                    <option value="high">High Safety Priority</option>
                                    <option value="medium">Medium Safety Priority</option>
                                    <option value="low">Low Safety Priority</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label for="projectCategory" class="form-label">Safety Category *</label>
                                <div class="input-group">
                                <select class="form-select" id="projectCategory" name="category" required>
                                        <option value="">Select Safety Category</option>
                                    </select>
                                    <button type="button" class="btn btn-outline-safety" onclick="openCategoryModal()" title="Manage Categories">
                                        <i class="fas fa-cog"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <label for="projectStartDate" class="form-label">Start Date *</label>
                                <input type="date" class="form-control" id="projectStartDate" name="startDate" required>
                            </div>
                            <div class="col-md-6">
                                <label for="projectDueDate" class="form-label">Safety Deadline <small class="text-muted">(Optional)</small></label>
                                <input type="date" class="form-control" id="projectDueDate" name="dueDate">
                                <div class="form-text">Leave blank if no specific deadline</div>
                            </div>
                            <div class="col-md-6">
                                <label for="projectCompletionDate" class="form-label">Completion Date <small class="text-muted">(Auto-filled when marked complete)</small></label>
                                <input type="date" class="form-control" id="projectCompletionDate" name="completionDate" tabindex="0">
                                <div class="form-text">Automatically set when project is marked as completed</div>
                            </div>
                            <div class="col-md-6">
                                <label for="projectAssignedTo" class="form-label">Assigned Team Members</label>
                                <div class="border rounded p-2" style="min-height: 120px; max-height: 200px; overflow-y: auto;">
                                    <div id="assignedUsersContainer">
                                        <!-- Selected users will appear here -->
                                    </div>
                                    <select class="form-select form-select-sm mt-2" id="projectAssignedTo" onchange="addAssignedUser()">
                                        <option value="">+ Add Team Member</option>
                                        <!-- Will be populated dynamically -->
                                    </select>
                                </div>
                                <div class="form-text">You can assign multiple team members to this project</div>
                            </div>
                            <div class="col-md-6">
                                <label for="projectStatus" class="form-label">Status</label>
                                <select class="form-select" id="projectStatus" name="status" required>
                                    <option value="active">Active</option>
                                    <option value="on-going">Ongoing</option>
                                    <option value="on-hold">On Hold</option>
                                    <option value="completed">Completed</option>
                                    <option value="cancelled">Cancelled</option>
                                </select>
                            </div>
                            <div class="col-md-12">
                                <label for="projectScreenshots" class="form-label">Screenshots</label>
                                <input type="file" class="form-control" id="projectScreenshots" name="screenshots" multiple accept="image/*">
                                <small class="form-text text-muted">Upload multiple images (PNG, JPG, GIF)</small>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-safety" id="submitText">Create Safety Project</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Compliance Modal -->
    <div class="modal fade" id="complianceModal" tabindex="-1" aria-labelledby="complianceModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="complianceModalTitle">New Compliance Item</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <form id="complianceForm">
                    <div class="modal-body">
                        <div class="row g-3">
                            <div class="col-md-12">
                                <label for="complianceTitle" class="form-label">Compliance Item Title *</label>
                                <input type="text" class="form-control" id="complianceTitle" name="title" placeholder="e.g., Monthly Fire Safety Training" required>
                            </div>
                            <div class="col-md-12">
                                <label for="complianceDescription" class="form-label">Description</label>
                                <textarea class="form-control" id="complianceDescription" name="description" rows="3" placeholder="Additional details about this compliance requirement"></textarea>
                            </div>
                            <div class="col-md-6">
                                <label for="complianceType" class="form-label">Compliance Type *</label>
                                <select class="form-select" id="complianceType" name="type" required>
                                    <option value="">Select Type</option>
                                    <option value="training">Safety Training</option>
                                    <option value="inspection">Safety Inspection</option>
                                    <option value="audit">Safety Audit</option>
                                    <option value="drill">Emergency Drill</option>
                                    <option value="certification">Certification</option>
                                    <option value="equipment">Equipment Check</option>
                                    <option value="documentation">Documentation Review</option>
                                    <option value="other">Other</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label for="complianceTrainingDate" class="form-label">Date of Training/Completion</label>
                                <input type="date" class="form-control" id="complianceTrainingDate" name="trainingDate">
                            </div>
                            <div class="col-md-6">
                                <label for="complianceAssignedTo" class="form-label">Assigned To</label>
                                <select class="form-select" id="complianceAssignedTo" name="assignedTo">
                                    <option value="">Select Team Member</option>
                                    <!-- Will be populated by JavaScript -->
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label for="compliancePriority" class="form-label">Priority Level</label>
                                <select class="form-select" id="compliancePriority" name="priority">
                                    <option value="low">Low Priority</option>
                                    <option value="medium" selected>Medium Priority</option>
                                    <option value="high">High Priority</option>
                                    <option value="critical">Critical</option>
                                </select>
                            </div>
                            <div class="col-md-12">
                                <hr class="my-3">
                                <h6 class="mb-3">
                                    <i class="fas fa-calendar me-2"></i>Calendar Settings
                                </h6>
                            </div>
                            <div class="col-md-6">
                                <label for="calendarLocation" class="form-label">Training Location</label>
                                <input type="text" class="form-control" id="calendarLocation" name="location" placeholder="e.g., Conference Room A, Main Building" value="Safety Training Center">
                                <small class="text-muted">Where the training will take place</small>
                            </div>
                            <div class="col-md-6">
                                <label for="trainingDuration" class="form-label">Training Duration (hours)</label>
                                <select class="form-select" id="trainingDuration" name="duration">
                                    <option value="1">1 hour</option>
                                    <option value="2" selected>2 hours</option>
                                    <option value="3">3 hours</option>
                                    <option value="4">4 hours</option>
                                    <option value="6">6 hours</option>
                                    <option value="8">8 hours (full day)</option>
                                </select>
                                <small class="text-muted">How long the training will take</small>
                            </div>
                            <div class="col-md-12">
                                <label class="form-label">Export to Calendar</label>
                                <div class="row g-2">
                                    <div class="col-md-3">
                                        <button type="button" class="btn btn-outline-primary w-100" onclick="exportToOutlook()">
                                            <i class="fas fa-calendar me-2"></i>Outlook
                                        </button>
                                    </div>
                                    <div class="col-md-3">
                                        <button type="button" class="btn btn-outline-danger w-100" onclick="exportToGoogleCalendar()">
                                            <i class="fab fa-google me-2"></i>Google
                                        </button>
                                    </div>
                                    <div class="col-md-3">
                                        <button type="button" class="btn btn-outline-secondary w-100" onclick="exportToAppleCalendar()">
                                            <i class="fab fa-apple me-2"></i>Apple
                                        </button>
                                    </div>
                                    <div class="col-md-3">
                                        <button type="button" class="btn btn-outline-success w-100" onclick="exportComplianceToCalendar()">
                                            <i class="fas fa-download me-2"></i>ICS File
                                        </button>
                                    </div>
                                </div>
                                <small class="text-muted">Choose your calendar app or download ICS file</small>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-primary">Save Compliance Item</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- User Modal -->
    <div class="modal fade" id="userModal" tabindex="-1" aria-labelledby="userModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="userModalTitle">Add New Safety Team Member</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <form id="userForm">
                    <div class="modal-body">
                        <div class="row g-3">
                            <div class="col-md-12">
                                <label for="userName" class="form-label">Full Name *</label>
                                <input type="text" class="form-control" id="userName" name="name" required>
                            </div>
                            <div class="col-md-12">
                                <label for="userEmail" class="form-label">Email Address *</label>
                                <input type="email" class="form-control" id="userEmail" name="email" required>
                            </div>
                            <div class="col-md-12">
                                <label for="userDepartment" class="form-label">Department *</label>
                                <div class="input-group">
                                    <select class="form-select" id="userDepartment" name="department" required>
                                        <option value="">Select Department</option>
                                    </select>
                                    <button type="button" class="btn btn-outline-safety" onclick="openDepartmentModal()" title="Manage Departments">
                                        <i class="fas fa-cog"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="col-md-12">
                                <label for="userRole" class="form-label">Safety Role *</label>
                                <div class="input-group">
                                    <select class="form-select" id="userRole" name="role" required>
                                        <option value="">Select Role</option>
                                    </select>
                                    <button type="button" class="btn btn-outline-safety" onclick="openRoleModal()" title="Manage Roles">
                                        <i class="fas fa-cog"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-safety" id="userSubmitText">Add Team Member</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- User Management Modal -->
    <div class="modal fade" id="userManagementModal" tabindex="-1" aria-labelledby="userManagementModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Manage Safety Team Members</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead class="table-light">
                                <tr>
                                    <th>Name</th>
                                    <th>Email</th>
                                    <th>Department</th>
                                    <th>Role</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="userManagementTableBody">
                                <!-- Users will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-safety" onclick="openUserModal()">
                        <i class="fas fa-plus me-2"></i>Add New User
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Screenshot Modal -->
    <div class="modal fade screenshot-modal" id="screenshotModal" tabindex="-1" aria-labelledby="screenshotModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Project Screenshots</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div id="screenshotContainer">
                        <!-- Screenshots will be loaded here -->
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Progress Update Modal -->
    <div class="modal fade" id="progressModal" tabindex="-1" aria-labelledby="progressModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Update Project Progress</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="projectNameDisplay" class="form-label">Project</label>
                        <input type="text" class="form-control" id="projectNameDisplay" readonly>
                    </div>
                    <div class="mb-3">
                        <label for="progressSlider" class="form-label">Progress: <span id="progressValue">0</span>%</label>
                        <input type="range" class="form-range" id="progressSlider" min="0" max="100" value="0">
                        <div class="d-flex justify-content-between">
                            <small class="text-muted">0%</small>
                            <small class="text-muted">25%</small>
                            <small class="text-muted">50%</small>
                            <small class="text-muted">75%</small>
                            <small class="text-muted">100%</small>
                        </div>
                    </div>
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle me-2"></i>
                        <strong>Note:</strong> Projects will automatically be marked as "Complete" when progress reaches 100%.
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-safety" onclick="updateProjectProgress()">Update Progress</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Category Management Modal -->
    <div class="modal fade" id="categoryModal" tabindex="-1" aria-labelledby="categoryModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="categoryModalLabel">Manage Project Categories</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="row mb-3">
                        <div class="col-md-8">
                            <input type="text" class="form-control" id="categoryName" placeholder="Enter category name...">
                        </div>
                        <div class="col-md-4">
                            <button type="button" class="btn btn-safety w-100" onclick="addCategory()">
                                <i class="fas fa-plus me-2"></i>Add Category
                            </button>
                        </div>
                    </div>
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>Category Name</th>
                                    <th>Projects Count</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="categoryTableBody">
                                <!-- Categories will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Role Management Modal -->
    <div class="modal fade" id="roleModal" tabindex="-1" aria-labelledby="roleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="roleModalLabel">Manage User Roles</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="row mb-3">
                        <div class="col-md-8">
                            <input type="text" class="form-control" id="roleName" placeholder="Enter role name...">
                        </div>
                        <div class="col-md-4">
                            <button type="button" class="btn btn-safety w-100" onclick="addRole()">
                                <i class="fas fa-plus me-2"></i>Add Role
                            </button>
                        </div>
                    </div>
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>Role Name</th>
                                    <th>Users Count</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="roleTableBody">
                                <!-- Roles will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Department Management Modal -->
    <div class="modal fade" id="departmentModal" tabindex="-1" aria-labelledby="departmentModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="departmentModalLabel">Manage Departments</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="row mb-3">
                        <div class="col-md-8">
                            <input type="text" class="form-control" id="departmentName" placeholder="Enter department name...">
                        </div>
                        <div class="col-md-4">
                            <button type="button" class="btn btn-safety w-100" onclick="addDepartment()">
                                <i class="fas fa-plus me-2"></i>Add Department
                            </button>
                        </div>
                    </div>
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>Department Name</th>
                                    <th>Users Count</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="departmentTableBody">
                                <!-- Departments will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js";
        import { getFirestore, collection, doc, getDocs, setDoc, deleteDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-firestore.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-auth.js";

        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDtFzWjlpTGR5r7n3CqHmDcb8oCKnjoTYs",
            authDomain: "project-tracker-c3205.firebaseapp.com",
            projectId: "project-tracker-c3205",
            storageBucket: "project-tracker-c3205.firebasestorage.app",
            messagingSenderId: "801280592412",
            appId: "1:801280592412:web:39047f94b012ae57032dd9"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);

        // Make Firebase available globally
        window.firebaseApp = app;
        window.firestore = db;
        window.firebaseAuth = auth;
        
        // Make Firebase functions available globally
        window.firebaseFunctions = {
            signInAnonymously,
            collection,
            doc,
            getDocs,
            setDoc,
            deleteDoc,
            onSnapshot
        };
    </script>

    <!-- Import Modal -->
    <div class="modal fade" id="importModal" tabindex="-1" aria-labelledby="importModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title" id="importModalLabel">
                        <i class="fas fa-upload me-2"></i>Import Projects
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <!-- Step 1: File Upload -->
                    <div id="importStep1" class="import-step">
                        <div class="row">
                            <div class="col-md-8">
                                <h6 class="mb-3">Step 1: Choose Your File</h6>
                                <div class="mb-3">
                                    <label for="importFile" class="form-label">Select File to Import</label>
                                    <input type="file" class="form-control" id="importFile" accept=".xlsx,.xls,.csv" onchange="projectManager.handleFileSelect(event)">
                                    <div class="form-text">
                                        <i class="fas fa-info-circle me-1"></i>
                                        Supported formats: Excel (.xlsx, .xls), CSV (.csv)
                                    </div>
                                </div>
                                <div class="alert alert-info">
                                    <i class="fas fa-lightbulb me-2"></i>
                                    <strong>Tips for best results:</strong>
                                    <ul class="mb-0 mt-2">
                                        <li>First row should contain column headers</li>
                                        <li>Include columns like: Title, Description, Status, Assigned To, etc.</li>
                                        <li>For Notion: Export as CSV from your database</li>
                                        <li>For Google Sheets: Download as Excel or CSV</li>
                                    </ul>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="card bg-light">
                                    <div class="card-header">
                                        <h6 class="mb-0">Quick Templates</h6>
                                    </div>
                                    <div class="card-body">
                                        <button class="btn btn-outline-secondary btn-sm w-100 mb-2" onclick="projectManager.downloadImportTemplate()">
                                            <i class="fas fa-download me-1"></i>Download Excel Template
                                        </button>
                                        <button class="btn btn-outline-info btn-sm w-100" onclick="projectManager.showSampleData()">
                                            <i class="fas fa-eye me-1"></i>View Sample Format
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Step 2: Column Mapping -->
                    <div id="importStep2" class="import-step d-none">
                        <h6 class="mb-3">Step 2: Map Your Columns</h6>
                        <div class="row">
                            <div class="col-md-6">
                                <h6 class="text-muted">Your File Columns</h6>
                                <div id="fileColumns" class="border rounded p-3 bg-light">
                                    <!-- File columns will be populated here -->
                                </div>
                            </div>
                            <div class="col-md-6">
                                <h6 class="text-muted">SafeTrack Project Fields</h6>
                                <div id="projectFields" class="border rounded p-3">
                                    <!-- Project field mappings will be populated here -->
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Step 3: Preview -->
                    <div id="importStep3" class="import-step d-none">
                        <h6 class="mb-3">Step 3: Preview & Validate</h6>
                        <div class="mb-3">
                            <div class="alert alert-success">
                                <i class="fas fa-check-circle me-2"></i>
                                <span id="validProjectsCount">0</span> projects ready to import
                            </div>
                            <div id="errorAlert" class="alert alert-warning d-none">
                                <i class="fas fa-exclamation-triangle me-2"></i>
                                <span id="errorCount">0</span> rows have issues (will be skipped)
                            </div>
                        </div>
                        <div class="table-responsive" style="max-height: 400px; overflow-y: auto;">
                            <table class="table table-sm table-hover">
                                <thead class="table-dark sticky-top">
                                    <tr id="previewTableHeader">
                                        <!-- Headers will be populated -->
                                    </tr>
                                </thead>
                                <tbody id="previewTableBody">
                                    <!-- Preview data will be populated -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Progress -->
                    <div id="importProgress" class="d-none">
                        <div class="text-center">
                            <div class="spinner-border text-primary mb-3" role="status">
                                <span class="visually-hidden">Importing...</span>
                            </div>
                            <h6>Importing Projects...</h6>
                            <div class="progress">
                                <div class="progress-bar" role="progressbar" style="width: 0%" id="importProgressBar"></div>
                            </div>
                            <p class="text-muted mt-2" id="importProgressText">Processing...</p>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-outline-primary" id="importBackBtn" onclick="projectManager.importPreviousStep()" style="display: none;">
                        <i class="fas fa-arrow-left me-1"></i>Back
                    </button>
                    <button type="button" class="btn btn-primary" id="importNextBtn" onclick="projectManager.importNextStep()" disabled>
                        Next <i class="fas fa-arrow-right ms-1"></i>
                    </button>
                    <button type="button" class="btn btn-success" id="importFinalBtn" onclick="projectManager.executeImport()" style="display: none;">
                        <i class="fas fa-upload me-1"></i>Import Projects
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Certification Modal -->
    <div class="modal fade" id="certificationModal" tabindex="-1" aria-labelledby="certificationModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="certificationModalTitle">New Certification</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <form id="certificationForm">
                    <div class="modal-body">
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label for="certificationName" class="form-label">Certification Name *</label>
                                <input type="text" class="form-control form-control-enhanced" id="certificationName" required
                                       placeholder="e.g., OSHA 30-Hour Construction Safety">
                            </div>
                            <div class="col-md-6">
                                <label for="certificationProvider" class="form-label">Provider/Organization *</label>
                                <input type="text" class="form-control form-control-enhanced" id="certificationProvider" required
                                       placeholder="e.g., OSHA, NFPA, Red Cross">
                            </div>
                            <div class="col-md-6">
                                <label for="certificationNumber" class="form-label">Certificate Number</label>
                                <input type="text" class="form-control form-control-enhanced" id="certificationNumber"
                                       placeholder="Certificate ID or number">
                            </div>
                            <div class="col-md-6">
                                <label for="certificationLevel" class="form-label">Level/Type</label>
                                <select class="form-select form-control-enhanced" id="certificationLevel">
                                    <option value="">Select level...</option>
                                    <option value="basic">Basic</option>
                                    <option value="intermediate">Intermediate</option>
                                    <option value="advanced">Advanced</option>
                                    <option value="expert">Expert/Master</option>
                                    <option value="instructor">Instructor</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label for="certificationIssueDate" class="form-label">Issue Date *</label>
                                <input type="date" class="form-control form-control-enhanced" id="certificationIssueDate" required>
                            </div>
                            <div class="col-md-6">
                                <label for="certificationExpiryDate" class="form-label">Expiry Date</label>
                                <input type="date" class="form-control form-control-enhanced" id="certificationExpiryDate">
                                <div class="form-text">Leave blank if certification doesn't expire</div>
                            </div>
                            <div class="col-12">
                                <label for="certificationDescription" class="form-label">Description</label>
                                <textarea class="form-control form-control-enhanced" id="certificationDescription" rows="3"
                                          placeholder="Brief description of the certification and skills covered..."></textarea>
                            </div>
                            <div class="col-12">
                                <label for="certificationFile" class="form-label">Certificate Image/PDF</label>
                                <input type="file" class="form-control form-control-enhanced" id="certificationFile" 
                                       accept="image/*,.pdf" onchange="handleCertificationFileUpload(this)">
                                <div class="form-text">Upload a screenshot or PDF of your certificate (Max 5MB)</div>
                                <div id="certificationFilePreview" class="mt-2"></div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-safety btn-enhanced">
                            <span id="certificationSubmitText">Add Certification</span>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Quote Management Modal -->
    <div class="modal fade" id="quoteModal" tabindex="-1" aria-labelledby="quoteModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="quoteModalTitle">Manage Safety Quotes</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6">
                            <h6>Current Quote</h6>
                            <div class="card bg-light">
                                <div class="card-body">
                                    <blockquote class="blockquote mb-0">
                                        <p id="currentQuoteDisplay">"Safety is not a gadget but a state of mind."</p>
                                        <footer class="blockquote-footer" id="currentAuthorDisplay">Eleanor Everet</footer>
                                    </blockquote>
                                </div>
                            </div>
                            <div class="mt-3">
                                <button class="btn btn-outline-primary btn-sm" onclick="getNewQuote()">
                                    <i class="fas fa-refresh me-1"></i>Random Quote
                                </button>
                                <button class="btn btn-outline-success btn-sm" onclick="addToFavorites()">
                                    <i class="fas fa-heart me-1"></i>Add to Favorites
                                </button>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <h6>Add Custom Quote</h6>
                            <form id="customQuoteForm">
                                <div class="mb-3">
                                    <label for="customQuoteText" class="form-label">Quote Text</label>
                                    <textarea class="form-control form-control-enhanced" id="customQuoteText" rows="3" 
                                              placeholder="Enter an inspiring safety quote..." required></textarea>
                                </div>
                                <div class="mb-3">
                                    <label for="customQuoteAuthor" class="form-label">Author</label>
                                    <input type="text" class="form-control form-control-enhanced" id="customQuoteAuthor" 
                                           placeholder="Author name (optional)">
                                </div>
                                <button type="submit" class="btn btn-safety btn-sm">
                                    <i class="fas fa-plus me-1"></i>Add Quote
                                </button>
                            </form>
                        </div>
                    </div>
                    
                    <hr class="my-4">
                    
                    <div class="row">
                        <div class="col-12">
                            <h6>Quote Collection</h6>
                            <div class="quote-stats mb-3">
                                <span class="badge bg-primary me-2">Total: <span id="totalQuotes">0</span></span>
                                <span class="badge bg-success me-2">Built-in: <span id="builtinQuotes">0</span></span>
                                <span class="badge bg-info me-2">Custom: <span id="customQuotes">0</span></span>
                                <span class="badge bg-warning">Favorites: <span id="favoriteQuotes">0</span></span>
                            </div>
                            <div class="d-flex gap-2 mb-3">
                                <button class="btn btn-outline-secondary btn-sm" onclick="showAllQuotes()">All Quotes</button>
                                <button class="btn btn-outline-success btn-sm" onclick="showBuiltinQuotes()">Built-in</button>
                                <button class="btn btn-outline-info btn-sm" onclick="showCustomQuotes()">Custom</button>
                                <button class="btn btn-outline-warning btn-sm" onclick="showFavoriteQuotes()">Favorites</button>
                            </div>
                            <div id="quoteList" class="quote-list" style="max-height: 300px; overflow-y: auto;">
                                <!-- Quote list will be populated here -->
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-danger" onclick="resetQuotesToDefault()">Reset to Default</button>
                </div>
            </div>
        </div>
    </div>


        <!-- Admin Password Verification Modal -->
        <div class="modal fade" id="adminPasswordModal" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-sm">
            <div class="modal-content">
                <div class="modal-header text-center border-0 pb-0">
                    <div class="w-100">
                        <div class="mb-3">
                            <div class="d-inline-flex p-3 rounded-circle" style="background: linear-gradient(135deg, var(--safety-red) 0%, #b91c1c 100%);">
                                <i class="fas fa-user-shield text-white" style="font-size: 1.5rem;"></i>
                            </div>
                        </div>
                        <h5 class="modal-title" style="color: var(--safety-red);">Admin Verification</h5>
                        <p class="text-muted mb-0 small">Enter admin password to continue</p>
                    </div>
                </div>
                <div class="modal-body px-4 pb-4">
                    <form id="adminPasswordForm">
                        <div class="mb-3">
                            <label for="adminPassword" class="form-label">Admin Password</label>
                            <input type="password" class="form-control form-control-enhanced" id="adminPassword" required 
                                   placeholder="Enter admin password" autocomplete="current-password">
                        </div>
                        <button type="submit" class="btn btn-safety w-100 btn-enhanced">
                            <i class="fas fa-unlock me-2"></i>Verify Admin Access
                        </button>
                    </form>
                    <div id="adminPasswordError" class="alert alert-danger mt-3 d-none">
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        Invalid admin password. Access denied.
                    </div>
                </div>
                <div class="modal-footer border-0 pt-0">
                    <button type="button" class="btn btn-secondary btn-sm w-100" data-bs-dismiss="modal">
                        <i class="fas fa-times me-1"></i>Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- END OF Admin Password Verification Modal -->

<!-- Project Notes Modal -->
<div class="modal fade" id="projectNotesModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title">
                    <i class="fas fa-sticky-note me-2"></i>
                    Notes: <span id="notesProjectTitle"></span>
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <!-- User Notes Section -->
                <div class="mb-4">
                    <h6 class="fw-bold text-primary">
                        <i class="fas fa-user me-1"></i>User Notes
                    </h6>
                    <div id="userNotesList" class="mb-3"></div>
                    <form onsubmit="event.preventDefault(); projectManager.addProjectNote(projectManager.currentNotesProjectId, document.getElementById('userNoteText').value, 'user');">
                        <div class="input-group">
                            <input type="text" class="form-control" id="userNoteText" 
                                   placeholder="Add a user note..." required>
                            <button class="btn btn-primary" type="submit">
                                <i class="fas fa-plus"></i> Add
                            </button>
                        </div>
                    </form>
                </div>

                <hr>

                <!-- Developer Notes Section -->
                <div>
                    <h6 class="fw-bold text-success">
                        <i class="fas fa-code me-1"></i>Developer Notes
                    </h6>
                    <div id="developerNotesList" class="mb-3"></div>
                    <form onsubmit="event.preventDefault(); projectManager.addProjectNote(projectManager.currentNotesProjectId, document.getElementById('developerNoteText').value, 'developer');">
                        <div class="input-group">
                            <input type="text" class="form-control" id="developerNoteText" 
                                   placeholder="Add a developer note..." required>
                            <button class="btn btn-success" type="submit">
                                <i class="fas fa-plus"></i> Add
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Cloud Storage Service -->
    <script src="assets/js/cloudStorage.js"></script>
    
    <!-- Custom JS -->
    <script src="assets/js/app.js"></script>
</body>
</html>

